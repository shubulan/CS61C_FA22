# RISC-V 单周期数据通路

## 1. precheck

1.1 单周期数据循环在每个指令都用到了所有的硬件

False; 所有的单元都参与了，但是其输出可能会被忽略

1.2 通过并行执行单周期数据循环中的各个阶段能够加速单个指令的执行

False; 每个阶段依赖于上一个阶段的结果

1.3 如果取指令内存的延迟减少了，任何单周期指令都会被加速

True; 每一个指令都需要从 IMEM 读数据。

1.4 控制信号在整个数据通路阶段都被使用到了，主要通过对指令的解码并使用解码结果来引导指令的正确执行

~~True;~~ False: 条件跳转需要先比较，才能确定 PCSel 的值

1.5 存储指令和加载指令是唯二需要DMEM的输入/输出的指令

~~False;~~ True; 除了这俩指令，都不需要读写DMEM

1.6 有可能同时使用立即数产生器和寄存器 rs2 的输出

False; 跟datapath设计有关。立即数和 rs2 要二选 1

## 2 单周期 CPU

2.1 

(a) 解释一下再下列数据通路阶段中发生了什么，哪些硬件单元参与了？

**IF** 指令获取
pc 给到 IMEM
IMEM 将指令放到 ReadData部分
pc += 4

硬件单元： pc/IMEM/+4 adder/PCSel

**ID** 指令解码

将指令固定是 寄存器选择 的位映射到 regfile 上以读取寄存器
生成立即数
指令完全映射到 control Logic 内解码后，将控制逻辑固定的信号置位

硬件单元：RegFile/ImmGen

**EX** 执行

电路中根据 regfile的输出 和 control logic 的信号输出，计算出结果。

硬件单元：ASel, BSel, ALU、比较器、~~立即数生成器~~

**MEM** 内存

对于 sotre、load 指令，根据计算结果将数据写入或者从DMEM获取

硬件单元：DMEM

**WB** 写回

~~大多是~~写回寄存器，
硬件单元： WBSel, RegFile

(b)

(c) 
PCSel: 选择 pc 更新为 +4 或者 一个计算结果

ImmSel: 选择采用哪一种方式拼接 指令中的立即数IBSJU 01234

BrLt: 小于跳转，比较器传给 control

BrEq: 等于跳转，比较器传给 control

MemRW: DMEM内存的读写允许。0 表示除了写都行 1 表示写

RegWEn: 寄存器允许写入

ALUSel: 选择计算方式：加法、减法等等 很多

WBSel: 写回到寄存器的选择：内存、alu计算、pc+4

2.2 

|    |BrEq|BrLT|PCSel|ImmSel| BrUn |ASel| BSel| ALUSel|MemRw |RegWEn| WBSel|
|----|----|----|---- |----  |----  |----|---- | ----  | ---- | ---- | ---- |
add  |*   |*   |0    |*     |*     |0   | 0   | add   |0(大多是0)|1     |1     |
ori  |*   |*   |0    | I    |*     |0   |1    | or    |0     |1     |1     |
 lw  |*   |*   |0    | I    |*     |0   |1    | add   |0     |1     |2     |
 sw  |*   |*   |0    | S    |*     |0   |1    | add   |1     |0     |*     |
beq  |0/1 |*   |0/1  | B    |* (相等无所谓)|1   |1    | add   |0     |0     |*     |
jal  |*   |*   |1    | J    |*     |1   |1    | add   |0     |1     |0     |
blt  |*   |0/1 |0/1  | B    |0     |1   |1    | add   |0     |0     |*     |    